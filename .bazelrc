# Default: use Bazel's host toolchain (no forced config). Use --config=gcc
# explicitly if you want host GCC/libstdc++.

# Platform configs for cross-compilation
build:amd64_musl --platforms=@zig_sdk//platform:linux_amd64
build:amd64_musl --extra_toolchains=@zig_sdk//toolchain:linux_amd64_musl
build:amd64_musl --define=libc=musl

build:amd64_gnu --platforms=@zig_sdk//platform:linux_amd64
build:amd64_gnu --extra_toolchains=@zig_sdk//toolchain:linux_amd64_gnu.2.31
build:amd64_gnu --define=libc=gnu

build:arm64_musl --platforms=@zig_sdk//platform:linux_arm64
build:arm64_musl --extra_toolchains=@zig_sdk//toolchain:linux_arm64_musl
build:arm64_musl --define=libc=musl

build:arm64_gnu --platforms=@zig_sdk//platform:linux_arm64
build:arm64_gnu --extra_toolchains=@zig_sdk//toolchain:linux_arm64_gnu.2.31
build:arm64_gnu --define=libc=gnu

# Force external capnp .c++ files to compile as C++ (target and host)
build --per_file_copt=external/capnp-cpp\\+/.*\.c\+\+@-xc++
build --per_file_copt=external/capnp-cpp\\+/.*@-xc++
build --per_file_copt=external/capnp-cpp~.*@-xc++
build --host_per_file_copt=external/capnp-cpp\\+/.*\.c\+\+@-xc++
build --host_per_file_copt=external/capnp-cpp\\+/.*@-xc++
build --host_per_file_copt=external/capnp-cpp~.*@-xc++

# Ensure all C++ objects are PIC so shared libs link under musl/clang
build --copt=-fPIC
build --cxxopt=-fPIC
